
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->

* [2 基础网络概念](#2-基础网络概念)
	* [2.1 网络是个什么玩意儿](#21-网络是个什么玩意儿)
		* [2.1.4 计算机网络协议： OSI 七层协定](#214-计算机网络协议-osi-七层协定)
			* [七层结构[1]](#七层结构1)
			* [五种中继系统[2]](#五种中继系统2)
			* [协议数据单元PDU[1]](#协议数据单元pdu1)
			* [交换机和路由器的区别[2]](#交换机和路由器的区别2)
			* [集线器与路由器在功能上有什么不同? [2]](#集线器与路由器在功能上有什么不同-2)
	* [2.2 TCP/IP的链结层相关协议](#22-tcpip的链结层相关协议)
		* [2.2.3 以太网络的传输协议： CSMA/CD](#223-以太网络的传输协议-csmacd)
			* [集线器](#集线器)
			* [网络宽带10M, 现在有个100M的文件,从互联网下载,理论上需要多少时间?](#网络宽带10m-现在有个100m的文件从互联网下载理论上需要多少时间)
		* [2.2.4 MAC 的封装格式](#224-mac-的封装格式)
			* [为什么资料量最小要46最大为1500 btyes呢？](#为什么资料量最小要46最大为1500-btyes呢)
	* [2.3 TCP/IP的网络层相关封包与数据](#23-tcpip的网络层相关封包与数据)
		* [2.3.1 IP封包的封装](#231-ip封包的封装)
		* [2.3.2 IP 地址的组成与分级](#232-ip-地址的组成与分级)
			* [IP](#ip)
			* [网域](#网域)
			* [IP分级](#ip分级)
			* [私有IP地址](#私有ip地址)
			* [子网掩码](#子网掩码)
		* [2.3.4 Netmask, 子网与 CIDR (Classless Interdomain Routing)](#234-netmask-子网与-cidr-classless-interdomain-routing)
			* [子网切分](#子网切分)
		* [2.3.5 路由概念](#235-路由概念)

<!-- /code_chunk_output -->
---

# 2 基础网络概念



## 2.1 网络是个什么玩意儿

### 2.1.4 计算机网络协议： OSI 七层协定


* 参考:
  1. [OSI（开放系统互联(Open System Interconnection)）_百度百科 ](https://baike.baidu.com/item/OSI/5520?fr=aladdin)
  2. [OSI七层模型详解 - - CSDN博客 ](http://blog.csdn.net/yaopeng_2005/article/details/7064869)

OSI七层协议（Open System Interconnection）

#### 七层结构[1]

|具体7层|数据格式|功能与连接方式|典型设备|
|-|-|-|-|
|应用层 Application|数据Data|网络服务与使用者应用程序间的一个接口|终端设备（PC、手机、平板等）|
|表示层 Presentation|数据Data|数据表示、数据安全、数据压缩|终端设备（PC、手机、平板等）|
|会话层 Session|数据Data|会话层连接到传输层的映射；会话连接的流量控制；数据传输；会话连接恢复与释放；会话连接管理、差错控制|终端设备（PC、手机、平板等）|
|传输层 Transport|数据组织成数据段Segment|用一个寻址机制来标识一个特定的应用程序（端口号）|终端设备（PC、手机、平板等）|
|网络层 Network|分割和重新组合数据包Packet|基于网络层地址（IP地址）进行不同网络系统间的路径选择|**网关、路由器**|
|**数据链路层** Data Link|将**比特**信息封装成**数据帧Frame**|在物理层上建立、撤销、标识逻辑链接和链路复用 以及差错校验等功能。通过使用接收系统的硬件地址或物理地址来寻址|**网桥、交换机**|
|**物理层**Physical|**传输比特（bit）流**|建立、维护和取消物理连接|光纤、同轴电缆、|**双绞线、网卡、中继器、集线器**|


#### 五种中继系统[2]

* **物理层**
  * （即常说的第一层、层Ｌ1）中继系统，即转发器（repeater）。
  * 网卡，网线，集线器，中继器，调制解调器。
  * **比特**
* **数据链路层**
  * （即第二层，层Ｌ2），即**网桥**或桥接器（bridge）。
  * 网桥，交换机。
  * **MAC**(Media Access Control)，**数据帧**。
  * 该层通常又被分为介质访问控制（MAC）和逻辑链路控制（LLC）两个子层
    * MAC子层的主要任务是解决共享型网络中多用户对信道竞争的问题，完成网络介质的访问控制
    * LLC子层的主要任务是建立和维护网络连接，执行差错校验、流量控制和链路控制。
* **网络层**
  * （第三层，层Ｌ3）中继系统，即**路由器**（router）。
  * 网桥和路由器的混合物桥路器（brouter）兼有网桥和路由器的功能。
  * 路由器。**IP**(Internet Protocol)，**数据包**。
* **传输层**。
  * 在网络层以上的中继系统，即**网关（gateway）**。
  * 网关工作在第四层传输层及其以上。
  * TCP，UDP，**数据段**。


#### 协议数据单元PDU[1]
OSI参考模型中，对等层协议之间交换的信息单元统称为协议数据单元(PDU，Protocol Data Unit)。而传输层及以下各层的PDU另外还有各自特定的名称：

* 传输层——数据段（Segment）
* 网络层——分组（数据包）（Packet）
* 数据链路层——数据帧（Frame）
* 物理层——比特（Bit）

#### 交换机和路由器的区别[2]

交换机拥有一条很高带宽的背部总线和内部交换矩阵。交换机的所有的端口都挂接在这条总线上，控制电路收到数据包以后，处理端口会查找内存中的**地址对照表**以确定目的MAC（网卡的硬件地址）的NIC（网卡）挂接在哪个端口上，通过内部交换矩阵迅速将数据包传送到目的端口，目的MAC若不存在则广播到所有的端口，接收端口回应后交换机会“学习”新的地址，并把它添加入内部MAC地址表中。 

使用交换机也可以把网络“分段”，通过对照MAC地址表，交换机只允许必要的网络流量通过交换机。通过交换机的过滤和转发，可以有效的隔离**广播风暴**，减少误包和错包的出现，避免共享冲突。 

交换机在同一时刻可进行多个端口对之间的数据传输。每一端口都可视为独立的网段，连接在其上的网络设备独自享有全部的带宽，无须同其他设备竞争使用。当节点A向节点D发送数据时，节点B可同时向节点C发送数据，而且这**两个传输都享有网络的全部带宽，都有着自己的虚拟连接**。假使这里使用的是10Mbps的以太网交换机，那么该交换机这时的总流通量就等于2×10Mbps＝20Mbps，而使用10Mbps的**共享式HUB**时，一个HUB的总流通量也不会超出10Mbps。 

总之，**交换机是一种基于MAC地址识别，能完成封装转发数据包功能的网络设备**。交换机可以“学习”MAC地址，并把其存放在内部地址表中，通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使数据帧直接由源地址到达目的地址。

从过滤网络流量的角度来看，路由器的作用与交换机和网桥非常相似。但是与工作在网络物理层，从物理上划分网段的交换机不同，路由器使用专门的软件协议从逻辑上对整个网络进行划分。例如，一台支持IP协议的路由器可以把网络划分成多个子网段，只有指向特殊IP地址的网络流量才可以通过路由器。对于每一个接收到的数据包，路由器都会重新计算其校验值，并写入新的物理地址。因此，使用路由器转发和过滤数据的速度往往要比只查看数据包物理地址的交换机慢。但是，对于那些结构复杂的网络，使用路由器可以提高网络的整体效率。路由器的另外一个明显优势就是可以自动过滤网络广播。

#### 集线器与路由器在功能上有什么不同? [2]

首先说**HUB**,也就是**集线器**。它的作用可以简单的理解为将一些机器连接起来组成一个局域网。而交换机（又名交换式集线器）作用与集线器大体相同。但是两者在性能上有区别：**集线器采用的式共享带宽的工作方式，而交换机是独享带宽**。这样在机器很多或数据量很大时，两者将会有比较明显的。而路由器与以上两者有明显区别，它的作用在于**连接不同的网段并且找到网络中数据传输最合适的路径**。路由器是产生于交换机之后，就像交换机产生于集线器之后，所以路由器与交换机也有一定联系，不是完全独立的两种设备。路由器主要克服了交换机不能路由转发数据包的不足。 

总的来说，路由器与交换机的主要区别体现在以下几个方面： 

（1）工作层次不同 
最初的的交换机是工作在**数据链路层**，而路由器一开始就设计工作在**网络层**。由于交换机工作在数据链路层，所以它的工作原理比较简单，而路由器工作在网络层，可以得到更多的协议信息，路由器可以做出更加智能的转发决策。 

（2）数据转发所依据的对象不同 
交换机是利用**物理地址或者说MAC地址来确定转发数据的目的地址**。而路由器则是利用**IP地址来确定数据转发的地址**。IP地址是在软件中实现的，描述的是设备所在的网络。MAC地址通常是硬件自带的，由网卡生产商来分配的，而且已经固化到了网卡中去，一般来说是不可更改的。而IP地址则通常由网络管理员或系统自动分配。 

（3）传统的交换机只能分割冲突域，不能分割广播域；而路由器可以分割广播域 
由交换机连接的网段仍属于同一个广播域，广播数据包会在交换机连接的所有网段上传播，在某些情况下会导致通信拥挤和安全漏洞。**连接到路由器上的网段会被分配成不同的广播域**，广播数据不会穿过路由器。虽然第三层以上交换机具有VLAN功能，也可以分割广播域，但是各子广播域之间是不能通信交流的，它们之间的交流仍然需要路由器。 

（4）路由器提供了防火墙的服务 
路由器仅仅转发特定地址的数据包，不传送不支持路由协议的数据包传送和未知目标网络数据包的传送，从而可以防止广播风暴。




## 2.2 TCP/IP的链结层相关协议

### 2.2.3 以太网络的传输协议： CSMA/CD

IEEE 802.3标准CSMA/CD（Carrier Sense Multiple Access with Collision Detection）

#### 集线器

* 集线器
  * 集线器是一种网络共享媒体；
  * 网络共享媒体在单一时间点内，仅能被一部主机所使用；
  * 不管哪一部主机发送讯框，集线器会复制一份该数据给所有计算机；


#### 网络宽带10M, 现在有个100M的文件,从互联网下载,理论上需要多少时间?

通常宽带的网络的流量速度单位是千比特/秒，即Kbps/s（Kbps = kilo bits per second），在电子学里面，1024 = 1K; 1024K = 1M; 1024M = 1G; 1024G = 1T...etc

8 bits = 1 byte (B);1024 byte = 1 KB(kilobyte);1024 Kbps = 1 Mbps

10M带宽换算成实际网速就是10M/bps＝10÷8MB/s＝1.25MB/s，即每秒能传输**1.25兆字节**的数据；

要下载100Mb文件下载时间理论上：100MB÷1.25MB/s＝80s，即80秒，相当于１分钟零20秒；

### 2.2.4 MAC 的封装格式


#### 为什么资料量最小要46最大为1500 btyes呢？

若要侦测碰撞，则讯框总数据量最小得要有64 bytes，那再扣除目的地址、来源地址、检查码（前导码不算）后，就可得到数据量最小得要有46 bytes。

64 - 46 = 18 = 目的地址6 + 来源地址6 + 资料栏位通信2 + 检查码4

硬件地址00:00:00:00:00:00到FF:FF:FF:FF:FF:FF这6 bytes。前 3 bytes为厂商的代码，后 3 bytes则是该厂商自行设定的装置码。

## 2.3 TCP/IP的网络层相关封包与数据

### 2.3.1 IP封包的封装

IPv4(Internet Protocol version 4，因特网协定第四版)

### 2.3.2 IP 地址的组成与分级

* [计算机网络之：网段与IP地址 - holybin的专栏 - CSDN博客 ](http://blog.csdn.net/holybin/article/details/22867767)

#### IP

* IP：
  * IP(Internet Protocol)是一种网络封包；
  * 封包的表头最重要的就是32位的来源与目的地址；
  * 32 bits的IP分成四小段，每段含有8个bits；
  * 主要分为Net_ID(网域号码)与Host_ID(主机号码)两部分；

#### 网域

* 网域：  
  * **网域**的定义：在同一个物理网段内，主机的IP具有相同的Net_ID，并且具有独特的Host_ID；
  * 同网段内，Net_ID不变，Host_ID不重复；
  * Host_ID不可同时为0也不可同时为1；
  * Host_ID全为0表示整个网段的地址Network IP；
  * Host_ID全为1表示广播的地址Broadcast IP；
  * 同网段主机可通过CSMA/CD广播通信，也可通过MAC直接通信；

#### IP分级

InterNIC将整个IP网段分为五种等级。

其次是IP地址分为5类：数量非常有限的，非常大的网络（A类）；数量较多规模中等的网络（B类）；为数众多的小网络（C类），以及用于组播（D类）和研究和实验之用（E类）。区分的办法就是根据第一个8位组来判断：
* （1）对于A类地址，**分配IP地址的前8位作为网络地址，其余24位作为主机地址**。并且，这前8位二进制位中的**第一位必须是“0”**。转换成十进制后，其取值的范围应在0--127之间。再加上0和127已经被留做它用，所以A类网只有**126**个。
* （2）对于B类地址，**分配IP地址的前16位作为网络地址，其余16位作为主机地址**。并且，这前16位二进制位中的**前两位必须是“10”**。转换成十进制后，其取值的范围应在128--191之间。由于最高两位被限定为“10”，所以，实际上只有其后的14位用来区分网络地址，所以B；类地址有**16384**个。
* （3）对于C类地址，**分配IP地址的前24位作为网络地址，其余8位作为主机地址**。并且，这前24位二进制位中的**前三位必须是“110”**。转换成十进制后，其取值的范围应在192--223之间。所以**C类地址可以有2^21次方，共2097152个**。同时由于只有8位数字用于表示主机机址，所以**每个C类网只能有254台主机**（主机地址不能全为0或全为1：全0为子网地址，全1为广播地址）。
* （4）对于D类地址，**其IP地址前8位以“1110”开始，它是一个专门保留的地址**。它并不指向特定的网络，目前这一类地址被用在**多点广播（Multicasting）**中。多点广播地址用来一次寻址一组计算机，它标识共享同一协议的一组计算机。所以D类地址覆盖范围为224.0.0.0-239.255.255.255，但是不标识网络。
* （5）对于E类地址，其IP地址前8位以“1111”开始，为将来使用保留，主要用于Internet试验和开发。所以E类地址的覆盖范围为240.0.0.0-255.255.255.255，其中240.0.0.0-255.255.255.254作为保留地址，255.255.255.255作为广播地址。

#### 私有IP地址

3、此外还有私有IP地址。**私有IP就是在本地局域网上的IP，与之对应的是公有IP（在互联网上的IP）**。随着私有IP网络的发展，为节省可分配的注册IP地址，有一组IP地址被拿出来专门用于私有IP网络，称为私有IP地址。私有IP地址的范围如下：

* A类：10.0.0.0-10.255.255.255，即：10.0.0.0/8
* B类：172.16.0.0-172.31.255.255，即：172.16.0.0/12
* C类：192.168.0.0~192.168.255.255，即：192.168.0.0/16

这些地址是不会被Internet分配的，它们在Internet上也不会被路由，虽然它们不能直接和Internet网连接，但通过技术手段仍旧可以和 Internet通讯（NAT技术）。我们可以根据需要来选择适当的地址类，在内部局域网中将这些地址像公用IP地址一样地使用。在Internet上，有些不需要与 Internet通讯的设备，如打印机、可管理集线器等也可以使用这些地址，以节省IP地址资源。

#### 子网掩码

最后说说子网掩码。子网掩码也是由32位二进位组成的，它用于表示TCP/IP主机的IP地址中哪些位对应于网络地址，哪些位对应于主机地址。计算方法为：子网掩码中1所对应的部分网络地址，0所对应的部分为主机地址，即将IP地址与子网掩码按位进行逻辑与操作。例如一台主机的IP地址为192.168.0.1（对应的二进制位为110000001010100000000000000000001），子网掩码为255.255.255.0（对应的二进制位为11111111111111111111111100000000），按位与之后得到192.168.0.0。由于子网掩码的前24位为1，表示该IP地址的前24位为网络地址，后8位为主机地址，所以我们表示成192.168.0.0/24，称为192.168.0.1的网络地址（网络ID）。不同的网络地址属于不同的网段（也叫子网）。

所以，比较IP地址是否在同一个网段或者子网时，需要结合子网掩码并分两种情况讨论：
* （1）**如果子网掩码相同**，则直接把IP地址与子网掩码按位“与”操作后看是否相同：相同则是同一个网段，否则不是。举个例子：192.168.0.1和192.168.1.5这两个IP，如果子网掩码是255.255.0.0的话，则属于同一个子网；如果子网掩码是255.255.255.0，则不属于同一个子网。
* （2）**如果子网掩码不同**，严格上说是不能比较的。但如果要比较的话，则需要找一个基准子网来比较，即将“与”操作后的结果与该基准子网比较判断。举个例子：192.168.1.1/30和192.168.1.10/24，虽然“与”操作后的结果都是192.168.1.0，但是子网掩码不同不能简单比较。
这里首先分别与24位掩码做“与”操作：

11000000.10101000.00000001.00000001（192.168.1.1）
11111111.11111111.11111111.00000000（24位掩码）
------------------与------------------------------
11000000.10101000.00000001.00000000（192.168.1.0）

11000000.10101000.00000001.00001010（192.168.1.10）
11111111.11111111.11111111.00000000（24位掩码）
------------------与------------------------------
11000000.10101000.00000001.00000000（192.168.1.0）
结果相同，所以这里可以说他们都在192.168.1.0/24这个子网里面。

然后分别与30位掩码做“与”操作：
11000000.10101000.00000001.00000001（192.168.1.1）
11111111.11111111.11111111.11111100（30位掩码）
------------------与------------------------------
11000000.10101000.00000001.00000000（192.168.1.0）

11000000.10101000.00000001.00001010（192.168.1.10）
11111111.11111111.11111111.11111100（30位掩码）
------------------与------------------------------
11000000.10101000.00000001.00001000（192.168.1.8）
结果不同，所以这里不能说他们都在192.168.1.0/30这个子网里面。

从另一个角度来看，我们把192.168.1.1/30和192.168.1.10/24所包含的IP地址分别列举出来：
192.168.1.1/30所在的子网里面有4个IP：192.168.1.0、192.168.1.1、192.168.1.2、192.168.1.3（全为0和全为1的IP不能用，实际2个）；
192.168.1.10/24所在的子网里有256个IP：192.168.1.0、192.168.1.1、192.168.1.2……192.168.1.255（全为0和全为1的IP不能用，实际254个）；
这么看来192.168.1.1/30所在的子网只是192.168.1.10/24所在的子网的一部分。因此192.168.1.1/30所在子网里面的IP能够直接PING到192.168.1.10/24所在子网里面的IP，并且直接通信时都不需要用ARP得到对方的MAC地址。
这个帖子里面有相关的讨论：判断两个IP地址是否属于同一个网段？ - CCNA学习小组 - 思科网络学习空间

### 2.3.4 Netmask, 子网与 CIDR (Classless Interdomain Routing)


#### 子网切分



### 2.3.5 路由概念

在同一个区网中，可以通过IP广播的方式来达到资料传递的目的。