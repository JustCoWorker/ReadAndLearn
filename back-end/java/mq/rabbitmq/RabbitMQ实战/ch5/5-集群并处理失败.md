

# 第5章 集群并处理失败


## 5.1 开足马力：RabbitMQ集群

* RabbitMQ内建集群用于完成两个目标
  * 允许消费者和生产者在Rabbit节点崩溃的情况下继续运行
  * 添加更多的节点来线性扩展消息通信吞吐量
* 节点崩溃
  * 一个Rabbit集群节点崩溃时，该节点上队列的消息也会消失
  * RabbitMQ默认不会将队列的内容复制到整个集群上

## 5.2 集群架构

* RabbitMQ四种类型的内部元数据
  * 队列元数据
  * 交换器元数据
  * 绑定元数据：展示如何将消息路由到队列
  * vhost元数据：为vhost内的队列、交换器和绑定提供命名空间和安全属性
* 信息存储
  * 单一节点
    * 将所有的元数据存储在内存中
    * 将标记为可持久化的队列和交换器以及绑定存储到硬盘上
  * 引入集群
    * 新的元数据类型：`集群节点位置`
    * 节点与已记录的其他类型元数据的关系

### 5.2.1 集群中的队列

* 集群中的队列信息
  * 集群只会在单个节点而不是在所有节点上创建`完整的队列信息（元数据、状态、内容）`
  * 只有队列的所有者节点知道有关队列的`所有信息`
  * 所有其他非所有者节点只知道`队列的元数据`和指向该队列存在的那个`节点的指针`
* 默认请情况下RabbitMQ不将队列内容和状态复制到所有的节点
  * 存储空间：如果完整拷贝，新增节点不会带来更多的存储空间
  * 性能：如果需要复制消息到集群节点，新增节点，网络和磁盘负载都会增加
* 往Rabbit集群添加更多的节点意味着你将拥有更多的节点来传播`队列`，提升性能。

### 5.2.2 分布交换器